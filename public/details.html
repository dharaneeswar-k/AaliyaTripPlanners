<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Package Details - Aaliya Trip Planners</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <nav class="navbar navbar-premium navbar-expand-lg navbar-dark fixed-top py-0">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">
                <img src="images/logo.png" alt="Aaliya Trip Planners" height="85">
            </a>
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0 fw-semibold">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="common.html">Common Packages</a></li>
                    <li class="nav-item"><a class="nav-link" href="couple.html">Couple Packages</a></li>
                    <li class="nav-item"><a class="nav-link" href="vehicles.html">Transports</a></li>
                </ul>
                <a href="index.html#contact"
                    class="btn btn-outline-light ms-3 rounded-pill px-4 shadow-sm hover-lift">Contact Us</a>
            </div>
        </div>
    </nav>

    <div id="loading-spinner" class="text-center py-5" style="margin-top: 100px;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div id="details-content" style="display: none;">
        <header id="pkg-header-bg" class="page-header">
            <div class="container">
                <h1 class="text-white fw-bold mb-1" id="pkg-title">Package Title</h1>
                <p class="text-white-50 mb-0 lead"><i class="fas fa-map-marker-alt me-2"></i><span
                        id="pkg-destination">Destination</span></p>
            </div>
        </header>

        <div class="container py-5">
            <div class="col-lg-8">
                <div class="card border-0 shadow-sm p-4 mb-4 rounded-4">
                    <h4 class="fw-bold mb-3 text-primary">Overview</h4>
                    <div class="d-flex gap-4 mb-4 text-muted">
                        <div><i class="fas fa-clock me-2 text-warning"></i><span id="pkg-duration">Duration</span>
                        </div>
                        <div><i class="fas fa-tag me-2 text-success"></i><span id="pkg-price">Price</span></div>
                    </div>
                    <hr>
                    <h5 class="fw-bold mt-3 mb-3">Itinerary</h5>
                    <div id="pkg-itinerary" class="text-muted" style="white-space: pre-line;"></div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card border-0 shadow-sm p-4 rounded-4 position-sticky" style="top: 110px;">
                    <h5 class="fw-bold mb-3">What's Included</h5>
                    <ul class="list-unstyled mb-4" id="pkg-inclusions"></ul>

                    <h5 class="fw-bold mb-3 text-danger">Exclusions</h5>
                    <ul class="list-unstyled mb-4 text-muted small" id="pkg-exclusions"></ul>

                    <div class="d-grid gap-2">
                        <button id="book-btn" class="btn btn-primary rounded-pill py-3 fw-bold shadow">Book
                            Now</button>
                        <a href="https://wa.me/918526630786" target="_blank"
                            class="btn btn-outline-success rounded-pill py-2"><i
                                class="fab fa-whatsapp me-2"></i>Enquire on WhatsApp</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <div class="modal fade" id="packageEnquiryModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Booking</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form class="general-enquiry-form">
                        <input type="hidden" name="enquiryType" value="PACKAGE">
                        <input type="hidden" name="packageId" id="modal-package-id">
                        <input type="hidden" name="packageType" id="modal-package-type">
                        <p class="fw-bold text-primary mb-3" id="modal-package-title"></p>

                        <div class="mb-3" id="pkg-destination-group" style="display: none;">
                            <label class="form-label">Destination</label>
                            <input type="text" class="form-control" name="destination">
                        </div>

                        <div class="alert alert-warning small mb-3">
                            <i class="fas fa-info-circle me-2"></i>Note: Pickup & Drop available only from Dindigul and
                            Madurai.
                        </div>
                        <div class="mb-3"><label class="form-label">Date</label><input type="date"
                                class="form-control date-picker" name="travelDate" required></div>

                        <div class="mb-3"><label class="form-label">Name</label><input type="text" class="form-control"
                                name="name" required></div>
                        <div class="mb-3"><label class="form-label">Phone</label><input type="tel"
                                class="form-control phone-input" name="phone" required maxlength="10"></div>
                        <button type="submit" class="btn btn-primary w-100">Submit Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content text-center p-4 rounded-4">
                <div class="mb-3 text-success"><i class="fas fa-check-circle fa-3x"></i></div>
                <h3>Request Sent!</h3>
                <p>We will contact you shortly.</p>
                <button type="button" class="btn btn-primary rounded-pill px-4" data-bs-dismiss="modal">OK</button>
            </div>
        </div>
    </div>

    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container text-center small text-white-50">
            &copy; 2025 Aaliya Trip Planners. All rights reserved.
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');

            if (!id) {
                window.location.href = 'index.html';
                return;
            }

            try {
                const res = await fetch('/api/public/data');
                const data = await res.json();

                const pkg = data.packages.find(p => p._id === id);

                if (pkg) {
                    document.getElementById('loading-spinner').style.display = 'none';
                    document.getElementById('details-content').style.display = 'block';

                    document.title = `${pkg.title} - Details`;
                    document.getElementById('pkg-title').innerText = pkg.title;
                    document.getElementById('pkg-destination').innerText = pkg.destination || pkg.title;
                    document.getElementById('pkg-duration').innerText = pkg.duration || 'Flexible';
                    document.getElementById('pkg-price').innerText = pkg.startingPrice ? `â‚¹${pkg.startingPrice}` : 'Best Price';
                    document.getElementById('pkg-itinerary').innerText = pkg.itinerary || 'Contact us for itinerary details.';

                    if (pkg.images && pkg.images.length > 0) {
                        document.getElementById('pkg-header-bg').style.backgroundImage = `url('${pkg.images[0]}')`;
                    }

                    const inclList = document.getElementById('pkg-inclusions');
                    if (pkg.inclusions) {
                        const items = pkg.inclusions.split('\n');
                        items.forEach(item => {
                            if (item.trim()) inclList.innerHTML += `<li class="mb-2"><i class="fas fa-check text-success me-2"></i>${item}</li>`;
                        });
                    } else {
                        inclList.innerHTML = '<li class="text-muted">Standard inclusions apply.</li>';
                    }

                    const exclList = document.getElementById('pkg-exclusions');
                    if (pkg.exclusions) {
                        const items = pkg.exclusions.split('\n');
                        items.forEach(item => {
                            if (item.trim()) exclList.innerHTML += `<li><i class="fas fa-times me-2"></i>${item}</li>`;
                        });
                    }

                    document.getElementById('book-btn').onclick = () => {
                        openPackageModal(pkg._id, pkg.title, pkg.packageType, pkg.destination);
                    };

                } else {
                    alert('Package not found.');
                    window.location.href = 'index.html';
                }

            } catch (e) {
                // Error handling silently
            }
        });
    </script>
</body>

</html>